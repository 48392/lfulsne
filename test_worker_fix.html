<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞ - Online Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .title {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .slot-machine {
            background: #2c3e50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 3px solid #34495e;
        }

        .slot-display {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #bdc3c7;
        }

        .spin-button {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .spin-button:active {
            transform: translateY(0);
        }

        .bonus-button {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .bonus-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.4);
        }

        .bonus-button:active {
            transform: translateY(0);
        }

        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }

        .status.success {
            background: #d5f4e6;
            color: #27ae60;
            border: 2px solid #2ecc71;
        }

        .status.error {
            background: #fadbd8;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }

        .status.info {
            background: #d6eaf8;
            color: #3498db;
            border: 2px solid #3498db;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.success {
            color: #27ae60;
        }

        .log-entry.error {
            color: #e74c3c;
        }

        .log-entry.info {
            color: #3498db;
        }

        .spinning {
            animation: spin 0.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .coins {
            background: linear-gradient(45deg, #f1c40f, #f39c12);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞</h1>
        <div class="coins">üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="coins">1000</span></div>
        
        <div class="slot-machine">
            <div class="slot-display" id="slotDisplay">üé∞üé∞üé∞</div>
            <button class="spin-button" id="spinButton" onclick="spin()">üé≤ –ö—Ä—É—Ç–∏—Ç—å</button>
            <button class="bonus-button" id="bonusButton" onclick="claimBonus()">üéÅ –ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å</button>
        </div>

        <div class="status info" id="status">
            –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ! –ù–∞–∂–º–∏—Ç–µ "–ö—Ä—É—Ç–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å
        </div>

        <div class="log" id="log">
            <div class="log-entry info">üöÄ Online Mini App –∑–∞–≥—Ä—É–∂–µ–Ω</div>
            <div class="log-entry info">üì° Worker: https://slavka-bot-webhook.minuales.workers.dev</div>
        </div>
    </div>

    <script>
        let coins = 1000;
        let isSpinning = false;
        let lastResult = null;

        // –°–∏–º–≤–æ–ª—ã –¥–ª—è —Å–ª–æ—Ç –º–∞—à–∏–Ω—ã
        const symbols = ['üçé', 'üçä', 'üçá', 'üçí', 'üçã', 'üíé', '7Ô∏è‚É£', 'üé∞'];
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
        function updateCoins() {
            document.getElementById('coins').textContent = coins;
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // –ö—Ä—É—á–µ–Ω–∏–µ —Å–ª–æ—Ç –º–∞—à–∏–Ω—ã
        function spin() {
            if (isSpinning) return;
            
            if (coins < 10) {
                updateStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error');
                log('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —Å–ø–∏–Ω–∞', 'error');
                return;
            }

            isSpinning = true;
            coins -= 10;
            updateCoins();
            
            const spinButton = document.getElementById('spinButton');
            const slotDisplay = document.getElementById('slotDisplay');
            
            spinButton.disabled = true;
            slotDisplay.classList.add('spinning');
            updateStatus('üé∞ –ö—Ä—É—Ç–∏–º...', 'info');
            log('üé∞ –ù–∞—á–∏–Ω–∞–µ–º —Å–ø–∏–Ω', 'info');

            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–∞
            let spinCount = 0;
            const spinInterval = setInterval(() => {
                const result = symbols[Math.floor(Math.random() * symbols.length)] + 
                             symbols[Math.floor(Math.random() * symbols.length)] + 
                             symbols[Math.floor(Math.random() * symbols.length)];
                slotDisplay.textContent = result;
                spinCount++;
                
                if (spinCount >= 10) {
                    clearInterval(spinInterval);
                    finishSpin();
                }
            }, 100);
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ø–∏–Ω–∞
        function finishSpin() {
            const spinButton = document.getElementById('spinButton');
            const slotDisplay = document.getElementById('slotDisplay');
            
            isSpinning = false;
            spinButton.disabled = false;
            slotDisplay.classList.remove('spinning');
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const symbol1 = symbols[Math.floor(Math.random() * symbols.length)];
            const symbol2 = symbols[Math.floor(Math.random() * symbols.length)];
            const symbol3 = symbols[Math.floor(Math.random() * symbols.length)];
            
            lastResult = symbol1 + symbol2 + symbol3;
            slotDisplay.textContent = lastResult;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à
            if (symbol1 === symbol2 && symbol2 === symbol3) {
                const winAmount = 100;
                coins += winAmount;
                updateStatus(`üéâ –î–ñ–ï–ö–ü–û–¢! –í—ã–∏–≥—Ä—ã—à: ${winAmount} –º–æ–Ω–µ—Ç!`, 'success');
                log(`üéâ –î–ñ–ï–ö–ü–û–¢! –í—ã–∏–≥—Ä—ã—à: ${winAmount} –º–æ–Ω–µ—Ç`, 'success');
            } else if (symbol1 === symbol2 || symbol2 === symbol3 || symbol1 === symbol3) {
                const winAmount = 20;
                coins += winAmount;
                updateStatus(`üéä –í—ã–∏–≥—Ä—ã—à: ${winAmount} –º–æ–Ω–µ—Ç!`, 'success');
                log(`üéä –í—ã–∏–≥—Ä—ã—à: ${winAmount} –º–æ–Ω–µ—Ç`, 'success');
            } else {
                updateStatus('üòî –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!', 'error');
                log('üòî –ü—Ä–æ–∏–≥—Ä—ã—à', 'error');
            }
            
            updateCoins();
        }

        // –ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å
        async function claimBonus() {
            if (isSpinning) return;
            
            updateStatus('üéÅ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –±–æ–Ω—É—Å–µ...', 'info');
            log('üéÅ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –æ –±–æ–Ω—É—Å–µ', 'info');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ Telegram WebApp
            const tg = window.Telegram?.WebApp;
            let user_id = null;
            let initData = null;
            
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.id) {
                user_id = tg.initDataUnsafe.user.id;
                initData = tg.initData;
                log(`üë§ –ü–æ–ª—É—á–µ–Ω user_id –∏–∑ Telegram: ${user_id}`, 'info');
            } else {
                // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                user_id = 7167238342;
                log(`üë§ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π user_id: ${user_id}`, 'info');
            }
            
            const bonusData = {
                user_id: user_id,
                miniapp: 'slot_machine_online',
                event: 'claim_bonus',
                coins: coins,
                last_result: lastResult,
                timestamp: new Date().toISOString(),
                tgWebAppData: initData,
                source: 'online_miniapp'
            };
            
            try {
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ Worker: ${JSON.stringify(bonusData)}`, 'info');
                
                const response = await fetch('https://slavka-bot-webhook.minuales.workers.dev', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bonusData)
                });
                
                const result = await response.json();
                log(`üì• –û—Ç–≤–µ—Ç –æ—Ç Worker: ${JSON.stringify(result)}`, 'info');
                
                if (response.ok && result.status === 'success') {
                    updateStatus('‚úÖ –ë–æ–Ω—É—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram', 'success');
                    log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Worker', 'success');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
                    const bonusCoins = 500;
                    coins += bonusCoins;
                    updateCoins();
                    
                    log(`üí∞ –ü–æ–ª—É—á–µ–Ω –±–æ–Ω—É—Å: +${bonusCoins} –º–æ–Ω–µ—Ç`, 'success');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–∏–Ω–∏–∞–ø–ø —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        log('üîí –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–∏–Ω–∏–∞–ø–ø —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...', 'info');
                        updateStatus('üîí –ó–∞–∫—Ä—ã—Ç–∏–µ –º–∏–Ω–∏–∞–ø–ø–∞...', 'info');
                        
                        if (tg && tg.close) {
                            tg.close();
                            log('‚úÖ –ú–∏–Ω–∏–∞–ø–ø –∑–∞–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram API', 'success');
                        } else {
                            log('‚úÖ –ú–∏–Ω–∏–∞–ø–ø –∑–∞–∫—Ä—ã—Ç (–∏–º–∏—Ç–∞—Ü–∏—è)', 'success');
                        }
                    }, 3000);
                    
                } else {
                    throw new Error(result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        document.addEventListener('touchstart', function(e) {
            e.preventDefault();
        }, { passive: false });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            log('üéÆ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É', 'info');
            updateStatus('üéÆ –ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ! –ù–∞–∂–º–∏—Ç–µ "–ö—Ä—É—Ç–∏—Ç—å"', 'info');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                log('üì± Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
            } else {
                log('‚ö†Ô∏è Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)', 'info');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            log(`‚ùå –û—à–∏–±–∫–∞ JavaScript: ${e.message}`, 'error');
        });
    </script>
</body>
</html> 
