<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
            word-wrap: break-word;
        }
        
        .log-info { background: rgba(0, 123, 255, 0.2); }
        .log-success { background: rgba(40, 167, 69, 0.2); }
        .log-error { background: rgba(220, 53, 69, 0.2); }
        .log-warning { background: rgba(255, 193, 7, 0.2); }
        .log-debug { background: rgba(108, 117, 125, 0.2); }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }
        .status-loading { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –¢–µ—Å—Ç–æ–≤—ã–π –º–∏–Ω–∏–∞–ø–ø</h1>
        
        <div class="button-group">
            <button id="btn1">–ü–æ–¥—Ö–æ–¥ 1: WebApp.sendData()</button>
            <button id="btn2">–ü–æ–¥—Ö–æ–¥ 2: Fetch –Ω–∞ Worker</button>
            <button id="btn3">–ü–æ–¥—Ö–æ–¥ 3: Telegram.WebApp.sendData() + Fetch</button>
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="log-entry log-info">üöÄ –ú–∏–Ω–∏–∞–ø–ø –∑–∞–≥—Ä—É–∂–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π...</div>
        </div>
    </div>
    
    <script>
        const tg = window.Telegram.WebApp;
        const logContainer = document.getElementById('logContainer');
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        let requestId = 0;
        
        // URL Worker'–∞
        const WORKER_URL = 'https://test-bot-worker.minuales.workers.dev';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
            let statusIcon = '';
            if (type === 'success') statusIcon = '<span class="status-indicator status-online"></span>';
            else if (type === 'error') statusIcon = '<span class="status-indicator status-offline"></span>';
            else if (type === 'warning') statusIcon = '<span class="status-indicator status-loading"></span>';
            
            logEntry.innerHTML = `${statusIcon}[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        try {
            tg.ready();
            tg.expand();
            log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebApp: ${error.message}`, 'error');
        }
        
        // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        try {
            log('üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebApp:', 'info');
            log(`initDataUnsafe: ${JSON.stringify(tg.initDataUnsafe, null, 2)}`, 'debug');
            log(`User ID: ${tg.initDataUnsafe.user?.id}`, 'info');
            log(`First Name: ${tg.initDataUnsafe.user?.first_name}`, 'info');
            log(`Username: ${tg.initDataUnsafe.user?.username}`, 'info');
            log(`Language: ${tg.initDataUnsafe.user?.language_code}`, 'info');
            log(`Platform: ${tg.platform}`, 'info');
            log(`Version: ${tg.version}`, 'info');
        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ: ${error.message}`, 'error');
        }
        
        // –ü–æ–¥—Ö–æ–¥ 1: WebApp.sendData() - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
        document.getElementById('btn1').addEventListener('click', async () => {
            const currentRequestId = ++requestId;
            log(`=== –ü–û–î–•–û–î 1: WebApp.sendData() [ID: ${currentRequestId}] ===`, 'info');
            
            try {
                const data = {
                    event: 'button1_clicked',
                    user_id: tg.initDataUnsafe.user?.id,
                    timestamp: new Date().toISOString(),
                    request_id: currentRequestId,
                    approach: 'webapp'
                };
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WebApp.sendData(): ${JSON.stringify(data, null, 2)}`, 'info');
                
                tg.sendData(JSON.stringify(data));
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ WebApp.sendData()', 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 1: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
            }
        });
        
        // –ü–æ–¥—Ö–æ–¥ 2: Fetch –Ω–∞ Worker - –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ worker
        document.getElementById('btn2').addEventListener('click', async () => {
            const currentRequestId = ++requestId;
            log(`=== –ü–û–î–•–û–î 2: Fetch –Ω–∞ Worker [ID: ${currentRequestId}] ===`, 'info');
            
            try {
                const data = {
                    user_id: tg.initDataUnsafe.user?.id,
                    command: 'send_message',
                    approach: 'direct_fetch',
                    timestamp: new Date().toISOString(),
                    request_id: currentRequestId
                };
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å –Ω–∞ worker: ${JSON.stringify(data, null, 2)}`, 'info');
                log(`üåê Worker URL: ${WORKER_URL}`, 'info');
                
                const startTime = Date.now();
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                const endTime = Date.now();
                
                log(`‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: ${endTime - startTime}ms`, 'info');
                log(`üì• –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`, 'info');
                log(`üì• Headers –æ—Ç–≤–µ—Ç–∞: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`, 'debug');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                log(`üì• –û—Ç–≤–µ—Ç –æ—Ç worker: ${JSON.stringify(result, null, 2)}`, 'success');
                
                if (result.error) {
                    log(`‚ö†Ô∏è Worker –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${result.error}`, 'warning');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 2: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
            }
        });
        
        // –ü–æ–¥—Ö–æ–¥ 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - WebApp.sendData() + Fetch
        document.getElementById('btn3').addEventListener('click', async () => {
            const currentRequestId = ++requestId;
            log(`=== –ü–û–î–•–û–î 3: WebApp.sendData() + Fetch [ID: ${currentRequestId}] ===`, 'info');
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebApp.sendData()
                const webappData = {
                    event: 'button3_clicked',
                    user_id: tg.initDataUnsafe.user?.id,
                    approach: 'combined',
                    timestamp: new Date().toISOString(),
                    request_id: currentRequestId
                };
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebApp.sendData(): ${JSON.stringify(webappData, null, 2)}`, 'info');
                tg.sendData(JSON.stringify(webappData));
                log('‚úÖ WebApp.sendData() –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                
                // –ó–∞—Ç–µ–º –¥–µ–ª–∞–µ–º fetch –Ω–∞ worker
                const fetchData = {
                    user_id: tg.initDataUnsafe.user?.id,
                    command: 'send_message',
                    approach: 'combined',
                    timestamp: new Date().toISOString(),
                    request_id: currentRequestId
                };
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º fetch –Ω–∞ worker: ${JSON.stringify(fetchData, null, 2)}`, 'info');
                log(`üåê Worker URL: ${WORKER_URL}`, 'info');
                
                const startTime = Date.now();
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(fetchData)
                });
                const endTime = Date.now();
                
                log(`‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: ${endTime - startTime}ms`, 'info');
                log(`üì• –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`, 'info');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                log(`üì• –û—Ç–≤–µ—Ç –æ—Ç worker: ${JSON.stringify(result, null, 2)}`, 'success');
                
                if (result.error) {
                    log(`‚ö†Ô∏è Worker –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${result.error}`, 'warning');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 3: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
            }
        });
        
        // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è WebApp
        try {
            tg.onEvent('viewportChanged', () => {
                log('üîÑ WebApp: viewportChanged', 'warning');
            });
            
            tg.onEvent('themeChanged', () => {
                log('üé® WebApp: themeChanged', 'warning');
            });
            
            tg.onEvent('mainButtonClicked', () => {
                log('üîò WebApp: mainButtonClicked', 'warning');
            });
            
            tg.onEvent('backButtonClicked', () => {
                log('‚¨ÖÔ∏è WebApp: backButtonClicked', 'warning');
            });
            
            tg.onEvent('settingsButtonClicked', () => {
                log('‚öôÔ∏è WebApp: settingsButtonClicked', 'warning');
            });
            
            log('‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π WebApp —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π: ${error.message}`, 'error');
        }
        
        // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö
        log('üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã WebApp:', 'debug');
        log(`- tg.ready(): ${typeof tg.ready}`, 'debug');
        log(`- tg.expand(): ${typeof tg.expand}`, 'debug');
        log(`- tg.sendData(): ${typeof tg.sendData}`, 'debug');
        log(`- tg.onEvent(): ${typeof tg.onEvent}`, 'debug');
        log(`- tg.initDataUnsafe: ${typeof tg.initDataUnsafe}`, 'debug');
        
        log('üéØ –ú–∏–Ω–∏–∞–ø–ø –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!', 'success');
    </script>
</body>
</html> 
