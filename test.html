<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(0, 123, 255, 0.2); }
        .log-success { background: rgba(40, 167, 69, 0.2); }
        .log-error { background: rgba(220, 53, 69, 0.2); }
        .log-warning { background: rgba(255, 193, 7, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –¢–µ—Å—Ç–æ–≤—ã–π –º–∏–Ω–∏–∞–ø–ø</h1>
        
        <div class="button-group">
            <button id="btn1">–ü–æ–¥—Ö–æ–¥ 1: WebApp.sendData()</button>
            <button id="btn2">–ü–æ–¥—Ö–æ–¥ 2: Fetch –Ω–∞ Worker</button>
            <button id="btn3">–ü–æ–¥—Ö–æ–¥ 3: Telegram.WebApp.sendData() + Fetch</button>
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="log-entry log-info">üöÄ –ú–∏–Ω–∏–∞–ø–ø –∑–∞–≥—Ä—É–∂–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π...</div>
        </div>
    </div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const logContainer = document.getElementById('logContainer');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'info');
        log(`initDataUnsafe: ${JSON.stringify(tg.initDataUnsafe, null, 2)}`, 'info');
        log(`User ID: ${tg.initDataUnsafe.user?.id}`, 'info');
        log(`First Name: ${tg.initDataUnsafe.user?.first_name}`, 'info');
        
        // –ü–æ–¥—Ö–æ–¥ 1: WebApp.sendData() - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
        document.getElementById('btn1').addEventListener('click', async () => {
            log('=== –ü–û–î–•–û–î 1: WebApp.sendData() ===', 'info');
            
            try {
                const data = {
                    event: 'button1_clicked',
                    user_id: tg.initDataUnsafe.user?.id,
                    timestamp: new Date().toISOString()
                };
                
                log(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WebApp.sendData(): ${JSON.stringify(data)}`, 'info');
                
                tg.sendData(JSON.stringify(data));
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ WebApp.sendData()', 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 1: ${error.message}`, 'error');
            }
        });
        
        // –ü–æ–¥—Ö–æ–¥ 2: Fetch –Ω–∞ Worker - –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ worker
        document.getElementById('btn2').addEventListener('click', async () => {
            log('=== –ü–û–î–•–û–î 2: Fetch –Ω–∞ Worker ===', 'info');
            
            try {
                const data = {
                    user_id: tg.initDataUnsafe.user?.id,
                    command: 'send_message',
                    approach: 'direct_fetch'
                };
                
                log(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å –Ω–∞ worker: ${JSON.stringify(data)}`, 'info');
                
                const response = await fetch('https://shy-scene-5215.minuales.workers.dev', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`, 'info');
                
                const result = await response.json();
                log(`–û—Ç–≤–µ—Ç –æ—Ç worker: ${JSON.stringify(result)}`, 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 2: ${error.message}`, 'error');
            }
        });
        
        // –ü–æ–¥—Ö–æ–¥ 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - WebApp.sendData() + Fetch
        document.getElementById('btn3').addEventListener('click', async () => {
            log('=== –ü–û–î–•–û–î 3: WebApp.sendData() + Fetch ===', 'info');
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebApp.sendData()
                const webappData = {
                    event: 'button3_clicked',
                    user_id: tg.initDataUnsafe.user?.id,
                    approach: 'combined'
                };
                
                log(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebApp.sendData(): ${JSON.stringify(webappData)}`, 'info');
                tg.sendData(JSON.stringify(webappData));
                log('‚úÖ WebApp.sendData() –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                
                // –ó–∞—Ç–µ–º –¥–µ–ª–∞–µ–º fetch –Ω–∞ worker
                const fetchData = {
                    user_id: tg.initDataUnsafe.user?.id,
                    command: 'send_message',
                    approach: 'combined'
                };
                
                log(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º fetch –Ω–∞ worker: ${JSON.stringify(fetchData)}`, 'info');
                
                const response = await fetch('https://shy-scene-5215.minuales.workers.dev', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(fetchData)
                });
                
                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`, 'info');
                
                const result = await response.json();
                log(`–û—Ç–≤–µ—Ç –æ—Ç worker: ${JSON.stringify(result)}`, 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–¥—Ö–æ–¥–µ 3: ${error.message}`, 'error');
            }
        });
        
        // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è WebApp
        tg.onEvent('viewportChanged', () => {
            log('WebApp: viewportChanged', 'warning');
        });
        
        tg.onEvent('themeChanged', () => {
            log('WebApp: themeChanged', 'warning');
        });
        
        tg.onEvent('mainButtonClicked', () => {
            log('WebApp: mainButtonClicked', 'warning');
        });
        
        tg.onEvent('backButtonClicked', () => {
            log('WebApp: backButtonClicked', 'warning');
        });
        
        log('–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã', 'success');
    </script>
</body>
</html> 
