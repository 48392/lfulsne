<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
window.onload = function() {
  const tg = window.Telegram.WebApp;
  if (!tg || !tg.initDataUnsafe || !tg.initDataUnsafe.user) {
    alert('Откройте через Telegram!');
    return;
  }
  const userId = tg.initDataUnsafe.user.id;
  document.body.insertAdjacentHTML('beforeend', `<div>user_id: ${userId}</div>`);
  document.getElementById('claimBtn').onclick = async () => {
    try {
      const response = await fetch('https://slavka-bot-webhook.minuales.workers.dev/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: userId,
          miniapp: 'slot_machine_webapp',
          event: 'claim_bonus',
          coins: 70,
          last_result: 'FREESPINS',
          timestamp: new Date().toISOString()
        })
      });
      const result = await response.json();
      if (response.ok) {
        tg.close();
      } else {
        alert('Ошибка: ' + (result?.error || 'unknown'));
      }
    } catch (err) {
      alert('Ошибка отправки: ' + err.message);
    }
  };
};
</script>
<button id="claimBtn">Забрать бонуску</button>
