<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script> 
</head>
<body>
  <h1>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å:</h1>
  <button onclick="claim()">üéÅ –ó–∞–±—Ä–∞—Ç—å</button>

  <script>
    async function claim() {
      const user = Telegram.WebApp.initDataUnsafe?.user;

      if (!Telegram.WebApp || !Telegram.WebApp.initDataUnsafe) {
        alert("–û—à–∏–±–∫–∞: –æ—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram");
        return;
      }

      if (!user) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
        return;
      }

      try {
        const response = await fetch('https://worker-url.minuales.workers.dev/',  {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: user.id,
            event: 'claim_bonus',
            timestamp: new Date().toISOString()
          })
        });

        const result = await response.json();
        console.log("–û—Ç–≤–µ—Ç –æ—Ç Worker:", result);

        Telegram.WebApp.close(); // –∑–∞–∫—Ä—ã—Ç–∏–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
        alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
      }
    }
  </script>
</body>
</html>
